# Ouroboros Node Configuration Template
# Copy this file to .env and customize for your node

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# PostgreSQL connection string
# Format: postgres://username:password@host:port/database
DATABASE_URL=postgres://ouro:ouro_pass@localhost:5432/ouro_db

# RocksDB local storage path (relative or absolute)
ROCKSDB_PATH=node_data/rocksdb

# ============================================================================
# NODE IDENTITY
# ============================================================================

# Unique identifier for this node (used in consensus)
NODE_ID=node-1

# ============================================================================
# NETWORK CONFIGURATION
# ============================================================================

# API server address (HTTP/HTTPS endpoint for clients)
# Format: IP:PORT
API_ADDR=0.0.0.0:8001

# P2P listen address (for peer-to-peer connections)
# Format: IP:PORT
LISTEN_ADDR=0.0.0.0:9001

# BFT consensus port (HotStuff protocol)
BFT_PORT=9091

# Comma-separated list of BFT peer addresses
# Format: IP:PORT,IP:PORT,...
# Example for 3-node cluster:
BFT_PEERS=127.0.0.1:9092,127.0.0.1:9093

# ============================================================================
# SECURITY & AUTHENTICATION
# ============================================================================

# BFT secret seed (64-character hex string for validator keys)
# IMPORTANT: Keep this secret! Generate unique value for each node.
# Generate with: openssl rand -hex 32
BFT_SECRET_SEED=1111111111111111111111111111111111111111111111111111111111111111

# API keys for client authentication (comma-separated)
API_KEYS=your-secure-api-key-here

# Rate limiting for API endpoints (DoS protection)
# Enable/disable rate limiting
RATE_LIMIT_ENABLED=true

# Maximum requests per IP address per time window
# Default: 100 requests
RATE_LIMIT_MAX_REQUESTS=100

# Time window in seconds for rate limiting
# Default: 60 seconds (1 minute)
RATE_LIMIT_WINDOW_SECS=60

# Peer allowlist for P2P authentication (comma-separated node IDs or IP:PORT addresses)
# SECURITY: If set, only peers in this list can connect (prevents Eclipse/Sybil attacks)
# Leave empty to accept all peers (ONLY for testnets!)
# Example: PEER_ALLOWLIST=node-1,node-2,node-3,192.168.1.100:9001
# Production: Always set this to known validator node IDs
# PEER_ALLOWLIST=

# P2P rate limiting (DoS protection for peer connections)
# Maximum messages per peer per time window
# Default: 600 messages
P2P_MAX_MESSAGES_PER_WINDOW=600

# Time window for P2P rate limiting in seconds
# Default: 60 seconds (1 minute)
P2P_RATE_LIMIT_WINDOW_SECS=60

# Maximum concurrent connections per IP address
# Prevents connection flooding attacks
# Default: 10 connections
P2P_MAX_CONNECTIONS_PER_IP=10

# SQL Migration Signing (schema integrity protection)
# Enforce cryptographic signature verification on all SQL migrations
# Default: false (development), true (production recommended)
# When enabled, migrations without valid signatures are rejected
MIGRATION_SIGNING_ENFORCE=false

# Anchor service private key (optional, for mainchain anchoring)
# Leave empty to disable anchor operations
# ANCHOR_PRIVATE_KEY=

# ============================================================================
# TLS/SSL CONFIGURATION (Optional - for HTTPS)
# ============================================================================

# Path to TLS certificate file
# TLS_CERT_PATH=/path/to/cert.pem

# Path to TLS private key file
# TLS_KEY_PATH=/path/to/key.pem

# ============================================================================
# LOGGING & TRACING
# ============================================================================

# Rust log level: error, warn, info, debug, trace
# Use 'debug' or 'trace' to see distributed tracing correlation IDs
RUST_LOG=info

# Distributed Tracing
# - Automatically enabled for all HTTP requests
# - Generates unique trace IDs (UUIDs) for request correlation
# - Propagates via X-Trace-ID and X-Span-ID HTTP headers
# - Logs include [trace_id=<uuid>] prefix for correlation
# - No additional configuration required - works out of the box
#
# To trace a request across services:
# 1. Make request: curl -H "X-Trace-ID: your-custom-id" http://localhost:8001/health
# 2. Search logs for: grep "trace_id=your-custom-id" node.log
# 3. All operations for that request will have the same trace_id

# ============================================================================
# PERFORMANCE TUNING (Advanced)
# ============================================================================

# Maximum database connections in pool (default: 100)
# MAX_DB_CONNECTIONS=100

# Batch writer flush interval in milliseconds (default: 100)
# BATCH_FLUSH_INTERVAL_MS=100

# Batch size before automatic flush (default: 500)
# BATCH_SIZE=500

# ============================================================================
# TESTING & DEVELOPMENT (Do NOT use in production!)
# ============================================================================

# Use insecure mode (skip TLS verification, etc.)
# INSECURE_MODE=false

# Enable test mode (shorter timeouts, relaxed validation)
# TEST_MODE=false

# ============================================================================
# v0.3.0 FEATURES - NODE IDENTITY & WALLET LINKING
# ============================================================================

# Node identity file path (stores persistent node ID and metadata)
# Default: {ROCKSDB_PATH}/.node_identity.json
# IDENTITY_PATH=node_data/.node_identity.json

# Node keypair path (Ed25519 keypair for wallet linking signatures)
# Default: {ROCKSDB_PATH}/.node_keypair
# NODE_KEYPAIR_PATH=node_data/.node_keypair

# Wallet link file path (stores wallet-to-node link with dual signatures)
# Default: {ROCKSDB_PATH}/.wallet_link.json
# WALLET_LINK_PATH=node_data/.wallet_link.json

# Update config file path (stores auto-update settings)
# Default: {ROCKSDB_PATH}/.update_config.json
# UPDATE_CONFIG_PATH=node_data/.update_config.json

# Storage mode: "postgres" for full node, "rocks" for lightweight node
# Default: postgres
STORAGE_MODE=rocks

# ============================================================================
# DATA AVAILABILITY LAYER (Optional)
# ============================================================================
# NOTE: To use the Data Availability Layer, compile with:
#   cargo build --features data-availability
#
# Without this feature, AWS and IPFS dependencies are not compiled,
# significantly reducing build time and binary size.
# ============================================================================

# Enable data availability layer (IPFS + S3 + Archival)
# Default: false
DA_ENABLED=false

# IPFS Configuration
# Enable IPFS for content-addressed block storage
IPFS_ENABLED=false

# IPFS node address (HTTP API endpoint)
# Default: http://127.0.0.1:5001
IPFS_NODE_ADDR=http://127.0.0.1:5001

# Enable automatic pinning of blocks (prevent garbage collection)
# Default: true
IPFS_ENABLE_PINNING=true

# IPFS operation timeout in seconds
# Default: 30
IPFS_TIMEOUT_SECS=30

# S3 Configuration (AWS S3 or S3-compatible services like MinIO)
# Enable S3 for cloud backup redundancy
S3_ENABLED=false

# S3 bucket name
# Default: ouroboros-blocks
S3_BUCKET=ouroboros-blocks

# S3 key prefix (folder path)
# Default: mainchain/
S3_PREFIX=mainchain/

# AWS region
# Default: us-east-1
S3_REGION=us-east-1

# S3 endpoint URL (optional, for MinIO/LocalStack)
# Leave empty for standard AWS S3
# Example for MinIO: http://localhost:9000
# S3_ENDPOINT_URL=

# Archival Node Configuration
# Enable archival mode (long-term block history storage)
ARCHIVAL_ENABLED=false

# Retention period in days (0 = keep forever)
# Default: 0
ARCHIVAL_RETENTION_DAYS=0

# Enable automatic pruning of old blocks
# Default: false
ARCHIVAL_ENABLE_PRUNING=false

# ============================================================================
# SUBCHAIN RENT COLLECTION (Automatic)
# ============================================================================

# Enable automatic rent collection from subchains
# Default: true
RENT_COLLECTION_ENABLED=true

# Rent collection check interval in seconds
# Default: 10
RENT_CHECK_INTERVAL_SECS=10

# ============================================================================
# FEE DISTRIBUTION & ECONOMICS
# ============================================================================

# Treasury address for fee collection (receives 10% of all fees)
# Default: treasury_default_address
TREASURY_ADDRESS=treasury_default_address

# Note: Fee distribution is hardcoded as:
# - 70% to validators (split equally)
# - 10% burned (deflationary)
# - 10% to treasury
# - 10% to app developer (or treasury if not specified)

# ============================================================================
# NOTES
# ============================================================================
#
# 1. For production deployments:
#    - Generate unique BFT_SECRET_SEED for each validator
#    - Use strong API_KEYS (min 32 characters, random)
#    - Enable TLS/SSL (set TLS_CERT_PATH and TLS_KEY_PATH)
#    - Never commit .env file to version control!
#
# 2. Multi-node setup:
#    - Each node needs unique NODE_ID, API_ADDR, LISTEN_ADDR, BFT_PORT
#    - All nodes must share same DATABASE_URL (or use replication)
#    - BFT_PEERS should list OTHER nodes (not self)
#    - BFT_SECRET_SEED must be unique per node
#
# 3. Database setup:
#    - Run migrations before starting: cargo run --bin migrate
#    - Ensure PostgreSQL is running and accessible
#    - Create database: CREATE DATABASE ouro_db;
#    - Create user: CREATE USER ouro WITH PASSWORD 'ouro_pass';
#    - Grant permissions: GRANT ALL PRIVILEGES ON DATABASE ouro_db TO ouro;
#
# 4. Monitoring:
#    - Check logs: RUST_LOG=debug for verbose output
#    - Health check: curl http://localhost:8001/health
#    - Metrics: Use Prometheus exporters (optional)
#
# ============================================================================
